use ::java::data::advancement::predicate::EntityPredicate
use ::java::data::worldgen::feature::block_predicate::BlockPredicate
use ::java::util::attribute::AttributeOperation

struct LevelBasedValueMap {
    /// 等级依赖函数(https://zh.minecraft.wiki/w/魔咒数据格式/等级依赖函数)
	type: #[id="enchantment_level_based_value_type"] string,
	...minecraft:level_based_value[[type]],
}

type LevelBasedValue = (float | LevelBasedValueMap)

///-----------------------------------------------------------------------------

dispatch minecraft:resource[dragonsurvival:dragon_stage] to struct DragonStage {
    /// 决定此阶段是否是默认阶段全局列表的一部分(默认：false)
    is_default?: boolean,
    /// 阶段的最小和最大成长值
    growth_range: Bounds,
    /// 达到最大成长所需的刻数(可以在1刻到1年之间指定)(20刻 = 1秒)
    ticks_until_grown: int @ 20..630720000,
    /// 基于龙成长值(在范围内)缩放的比例属性修饰符
    /// (在范围内意味着如果阶段范围在10到15之间，当前成长值为12，则"等级"将为2)
    modifiers?: [Modifier],
    /// 可用于增加(或减少)龙成长值的物品
    growth_items?: [GrowthItem],
    /// 决定何时停止龙自然成长的条件
    is_natural_growth_stopped?: EntityPredicate,
    /// 破坏行为数据
    destruction_data?: DestructionData
}

struct Bounds {
    min: double @ 1..,
    max: double @ 1..
}

struct Modifier {
    attribute: #[id="attribute"] string,
    amount: (
        LevelBasedValue |
        PreciseLevelBasedValue |
    ),
    operation: AttributeOperation
}

struct GrowthItem {
    items: (
        #[id(registry="item", tags="allowed")] string |
        [#[id="item"] string] |
    ),
    /// 每次使用增加的成长值
    /// 值为0会使物品改为切换'is_growth_stopped'字段
    /// (该字段在默认的'is_natural_growth_stopped'条件中使用)
    growth_in_ticks: int,
    /// 决定此物品可以使用多少次(默认：无限)
    maximum_usages?: int @ 1..
}

struct DestructionData {
    /// 龙行走时能对实体造成碾压伤害的最小成长值
    crushing_growth: double,
    /// 龙行走时能破坏方块的最小成长值
    block_destruction_growth: double,
    /// 决定碾压伤害如何缩放(成长值 * 比例因子)
    crushing_damage_scalar: double,
    /// 决定龙行走时能够破坏的方块
    block_predicate: BlockPredicate,
    /// 决定行走时碾压伤害作用的实体
    entity_predicate: EntityPredicate,
}

/// 允许使用小数计算值
struct PreciseLevelBasedValue {
    precise_base: float,
    precise_amount: float
}